<script>
  var dataByQuestion = <%= raw @results_by_question.to_json %>
  var dataByAnswer = <%= raw @results_by_answer.to_json %>
  var dataByGroup = <%= raw @results_by_group.to_json %>
  var userGroups = <%= raw User.groups.to_json %>

  var getResultsByQuestion = function(question) {
    return dataByQuestion[question]
  }

  var getResultsByAnswer = function(question, answer) {
    var key = [question, answer].join(":")

    return dataByAnswer[key]
  }

  var getResultsByGroup = function(question, answer, group) {
    var groupId = userGroups[group]
    var key = [question, answer, groupId].join(":")

    return dataByGroup[key]
  }

  var getAnswerPercent = function (question, answer) {
    var total = getResultsByQuestion(question)
    var local = getResultsByAnswer(question, answer)

    return (local/total) * 100 || 0
  }
</script>

<script>
  var chartRadioDataset = function (questions, labels) {
    return [
      {
        label: "Strongly Agree",
        data: [
          getAnswerPercent(questions[0], "1"),
          getAnswerPercent(questions[1], "1"),
          getAnswerPercent(questions[2], "1"),
          getAnswerPercent(questions[3], "1"),
          getAnswerPercent(questions[4], "1")
        ],
        backgroundColor: ["rgb(0, 170, 94)"],
        borderColor: ["rgb(0, 170, 94)"],
        borderWidth: 1,
        stack: "stack0"
      },
      {
        label: "Agree",
        data: [
          getAnswerPercent(questions[0], "2"),
          getAnswerPercent(questions[1], "2"),
          getAnswerPercent(questions[2], "2"),
          getAnswerPercent(questions[3], "2"),
          getAnswerPercent(questions[4], "2")
        ],
        backgroundColor: ["rgb(149, 209, 60)"],
        borderColor: ["rgb(149, 209, 60)"],
        borderWidth: 1,
        stack: "stack0"
      },
      {
        label: "Neutral",
        data: [
          getAnswerPercent(questions[0], "2"),
          getAnswerPercent(questions[1], "2"),
          getAnswerPercent(questions[2], "2"),
          getAnswerPercent(questions[3], "2"),
          getAnswerPercent(questions[4], "2")
        ],
        backgroundColor: ["rgb(254, 213, 0)"],
        borderColor: ["rgb(254, 213, 0)"],
        borderWidth: 1,
        stack: "stack0"
      },
      {
        label: "Disagree",
        data: [
          getAnswerPercent(questions[0], "3"),
          getAnswerPercent(questions[1], "3"),
          getAnswerPercent(questions[2], "3"),
          getAnswerPercent(questions[3], "3"),
          getAnswerPercent(questions[4], "3")
        ],
        backgroundColor: ["rgb(254, 133, 0)"],
        borderColor: ["rgb(254, 133, 0)"],
        borderWidth: 1,
        stack: "stack0"
      },
      {
        label: "Strongly Disagree",
        data: [
          getAnswerPercent(questions[0], "4"),
          getAnswerPercent(questions[1], "4"),
          getAnswerPercent(questions[2], "4"),
          getAnswerPercent(questions[3], "4"),
          getAnswerPercent(questions[4], "4")
        ],
        backgroundColor: ["rgb(255, 92, 73)"],
        borderColor: ["rgb(255, 92, 73)"],
        borderWidth: 1,
        stack: "stack0"
      }
    ]
  }

  var chartRadioResults = function(id, questions, labels) {
    var ctx = document.getElementById(id)
    new Chart(ctx, {
      type: "horizontalBar",
      data: {
        labels: labels,
        datasets: chartRadioDataset(questions, labels)
      },
      options: {
        scales: {
          xAxes: [{
            display: true,
            stacked: true,
          }],
          yAxes: [{
            display: true,
            stacked: true
          }]
        },
        tooltips: {
          mode: "index",
          intersect: false
        }
      }
    })
  }

</script>

<canvas id="pros" width="400" height="150"></canvas>

<script>
  chartRadioResults(
    "pros",
    [
      "pro_tourism",
      "pro_property_values",
      "pro_personal_use",
      "pro_transportation",
      "pro_cleanup_land"
    ],
    [
      "Increase in tourism",
      "Increase in town-wide property values",
      "Recreational space",
      "Transportation path",
      "Beautification of land"
    ]
  )
</script>
